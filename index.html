<!doctype html>
<html> 
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="author" content="Martin SÃ½kora">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="http://robotikabrno.cz/css/design2.css">
    <meta name="theme-color" content="#9cb036"> 
    <style>
      button{
        padding: 5px;
        margin: 3px 3px 3px 0px;
      }
      
      button.empty_dir{
        background-color: rgb(255,32,0);
      }
    </style>
  </head>
  
  <body>
    <div id="header_bg"></div>
    <div id="main" class="home">
       
      <!--<div id="header">
        <div id="main_menu" class="shadow">
          <a href="/" style="text-decoration: none; color: white"><div class="logo_in_header"></div></a>
        </div>          
      </div>--> 
           
       
      <div id="files" class="shadow hp_div">
      
      <h1>files.robotikabrno.cz</h1>

      <hr>
    
      <?php
        $cache = explode('?', substr($_SERVER['REQUEST_URI'], 1));
        $cache = explode('#', $cache[0]);
        
        if(substr($cache[0], -1) == '/')
          $cache[0] = substr($cache[0], 0, -1);
        
        $cache[0] = rawurldecode($cache[0]);
        
         
        function size($path)
        {
          $size = filesize($path);
          if($size >= 1048576)
            return round(($size / 1048576), 1) . ' MB';
          else
            return round(($size / 1024), 1) . ' kB';
        }
        
        $id = 0;
        
        $levels = explode('/', $cache[0]);
        echo '<h2>Cesta: <a href="/">home</a>'; 
        $addr = '';
        foreach($levels as $level)
        {
          $addr .= '/' . $level;
          echo '/<a href="' . $addr . '">' . $level . '</a>';          
        }        
        echo '</h2>';
        
        $href_folder = '/' . $cache[0];
        if($cache[0] == '')
          unset($href_folder);
        scan('./' . $cache[0], $href_folder);
        function scan($folder = './', $href_folder = '')
        {
          echo '<ul id="' . $GLOBALS['id'] . '" style="display: none;">';
          $len = strlen($href_folder) + 2;
          foreach(glob('.' . $href_folder . "/*", GLOB_ONLYDIR) as $folder_2)
          {
            $foldername = substr($folder_2, $len);
            $counter = scandir($folder_2);
            if(count($counter) <= 2)
              $class = ' class="empty_dir"';
            else
              $class = '';
            echo '<li><a href="' . $href_folder . '/' . rawurlencode($foldername) . '"><button' . $class . '>' . $foldername . '</button></a></li>';  
          }
          foreach(glob('.' . $href_folder . "/*.*") as $file)
          {
            $filename = substr($file, $len);
            echo '<li><a target="_blank" href="' . $href_folder . '/' . rawurlencode($filename) . '">' . $filename . ' (' . size($file) . ')</a></li>';  
          }
          echo '</ul>';
        }
        
        
      ?>
      
      <script>
        document.getElementById('0').style.display = 'block';
      </script>
      
      </div>
      
      <a href="#header_bg" id="up" class="shadow">nahoru</a>
      
       <div id="footer" class="shadow">
        <div id="copyright">
        2014 - 2015 Robotika Brno
        </div> 
      </div>
        
    </div>
  </body>
</html>
